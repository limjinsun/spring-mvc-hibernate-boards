<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">

<title>User Page</title>

<!-- Favicons and -- For iPhone -->
<link rel="icon" th:href="@{'/resources/images/favicon.ico'}" sizes="32x32">
<link rel="apple-touch-icon-precomposed" th:href="@{'/resources/images/favicon.ico'}">
<meta name="msapplication-TileColor" content="#00bcd4">
<meta name="msapplication-TileImage" th:href="@{'/resources/images/favicon.ico'}">

<!-- CSS -->
<link rel="stylesheet" th:href="@{'/resources/vendors/iconfonts/mdi/css/materialdesignicons.min.css'}" type="text/css">
<link rel="stylesheet" th:href="@{'/resources/vendors/iconfonts/font-awesome/css/font-awesome.css'}" type="text/css">

<link href="https://cdn.muicss.com/mui-0.9.41/css/mui.min.css" rel="stylesheet" type="text/css">
<script src="https://cdn.muicss.com/mui-0.9.41/js/mui.min.js" type="text/javascript"></script>

<link rel="stylesheet" th:href="@{'/resources/vendors/icheck/skins/all.css'}" type="text/css">
<link rel="stylesheet" th:href="@{'/resources/css/style.css'}" type="text/css">
<link rel="stylesheet" th:href="@{'/resources/css/custom.css'}" type="text/css">
<link rel="stylesheet" th:href="@{'/resources/vendors/iconfonts/mdi/css/materialdesignicons.min.css'}" type="text/css">
<link rel="stylesheet" th:href="@{'/resources/vendors/css/vendor.bundle.base.css'}" type="text/css">
<link rel="stylesheet" th:href="@{'/resources/vendors/css/vendor.bundle.addons.css'}" type="text/css">

<style>
.borderon {
	/* border-style: solid;
	border-width: thin; */
	
}

.fixed_menu {
	position: fixed;
}

.margin_for_fixed {
	margin-left: 255px;
}

@media ( max-width :991px) {
	.fixed_menu {
		/* position: absolute; */
		
	}
	.margin_for_fixed {
		margin-left: 0;
	}
}

.navbar.default-layout {
	transition: background 0.25s ease;
	-webkit-transition: background 0.25s ease;
	-moz-transition: background 0.25s ease;
	-ms-transition: background 0.25s ease;
	background-color: rgba(255, 255, 255);
	background-image: linear-gradient(to right, rgba(255, 255, 255, 0),
		rgba(220, 220, 220, 0.4));
}

.navbar.default-layout .navbar-brand-wrapper .navbar-brand {
	color: #222;
}

.navbar-brand-wrapper {
	background-color: rgba(255, 255, 255 .5);
}

.navbar.default-layout .navbar-menu-wrapper {
	color: #222;
}

.content-wrapper {
	background: rgba(220, 220, 220, 0.1);
}
</style>


<style>
.modalDialog {
	position: fixed;
	font-family: Arial, Helvetica, sans-serif;
	top: 0;
	right: 0;
	bottom: 0;
	left: 0;
	background: rgba(0, 0, 0, 0.8);
	z-index: 99999;
	opacity: 0;
	-webkit-transition: opacity 400ms ease-in;
	-moz-transition: opacity 400ms ease-in;
	transition: opacity 400ms ease-in;
	pointer-events: none;
}

.modalDialog:target {
	opacity: 1;
	pointer-events: auto;
}

.modalDialog>div {
	width: 400px;
	position: relative;
	margin: 20% auto;
	padding: 15px 15px;
	border-radius: 3px;
	background: #fff;
	background: -moz-linear-gradient(#fff, #999);
	background: -webkit-linear-gradient(#fff, #999);
	background: -o-linear-gradient(#fff, #999);
}

.close {
	background: #606061;
	color: #FFFFFF;
	line-height: 25px;
	position: absolute;
	right: -12px;
	text-align: center;
	top: -10px;
	width: 24px;
	text-decoration: none;
	font-weight: bold;
	-webkit-border-radius: 12px;
	-moz-border-radius: 12px;
	border-radius: 12px;
	-moz-box-shadow: 1px 1px 3px #000;
	-webkit-box-shadow: 1px 1px 3px #000;
	box-shadow: 1px 1px 3px #000;
}

.close:hover {
	background: #00d9ff;
}
</style>

<style>
.sidebar .nav .nav-item .nav-link {
	padding: 5px 20px;
}

.sidebar .nav .nav-item.nav-profile .nav-link .user-wrapper {
	margin: 15px 5px;
}
</style>


<style>
.bg-color-a {
	background-color: #f7f7f7ba;
}
</style>
</head>


<body>
	<div class="container-scroller">
		<!-- partial:partials/_navbar.html -->
		<nav class="navbar default-layout col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
			<div class="text-center navbar-brand-wrapper d-flex align-items-top justify-content-center">
				<a class="navbar-brand brand-logo" th:href="@{'/'}"> <!-- <span class="mdi mdi-view-agenda rotate-90 icon-xmd" style="padding-top: 4px;"></span> --> <span class="menu-title font-b iconic-text"> <small class="borderlist">리피의아일랜드</small>
				</span> <!-- <img th:src="@{'/resources/images/icon-cube-green.svg'}" alt="" /> --> <!-- <img th:src="@{'/resources/images/main-logo.svg'}" alt="" /> -->
				</a> <a class="navbar-brand brand-logo-mini" th:href="@{'/'}"> <!-- <span class="menu-title font-b">
						<small class="borderlist">리피</small>
					</span> --> <span> <small class="borderlist">홈</small> <!-- <i class="mdi mdi-view-agenda rotate-90 icon-xmd" style="padding-top: 14px;"></i> -->
				</span> <!-- <img th:src="@{'/resources/images/icon-cube-green.svg'}" alt="" /> -->
				</a>
			</div>
			<div class="navbar-menu-wrapper d-flex align-items-center">
				<ul class="navbar-nav navbar-nav-right">
					<li class="nav-item dropdown d-none d-xl-inline-block">
						<!-- 네비게이션 바 - 유저 프로파일 <a class="nav-link dropdown-toggle" id="UserDropdown" href="#" data-toggle="dropdown" aria-expanded="false"> --> <span class="profile-text">Hello!&nbsp;</span> <span class="profile-text" th:text="${user.getFname()}">Hello, Richard V.Welsh !</span> <span class="profile-text" style="margin-right: 15px;"> 님</span> <a id="UserDropdown" href="#" data-toggle="dropdown" aria-expanded="false"> <img class="img-xs rounded-circle" th:src="@{'/resources'+${userProfile.getUserpics()}}" alt="Profile image">
					</a> <!-- </a> -->

						<div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="UserDropdown">
							<a class="dropdown-item p-0">
								<div class="d-flex border-bottom">
									<div class="py-3 px-4 d-flex align-items-center justify-content-center">
										<i class="mdi mdi-bookmark-plus-outline mr-0 text-gray"></i>
									</div>
									<div class="py-3 px-4 d-flex align-items-center justify-content-center border-left border-right">
										<i class="mdi mdi-account-outline mr-0 text-gray"></i>
									</div>
									<div class="py-3 px-4 d-flex align-items-center justify-content-center">
										<i class="mdi mdi-alarm-check mr-0 text-gray"></i>
									</div>
								</div>
							</a>
							<div class="col-12 d-flex align-items-center" style="margin-top: 10px">
								<a class="dropdown-item d-flex align-items-center" href="#openModal"> <i class="mdi mdi-account-remove mr-0 text-gray"></i> &nbsp탈퇴하기
								</a>
							</div>
							<!-- 	<a class="dropdown-item mt-2"> Manage Accounts </a>
							<a class="dropdown-item"> Change Password </a> -->

							<!-- 							<a class="dropdown-item"> Sign Out </a>
 -->
						</div>


					</li>
				</ul>
				<button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
					<span class="mdi mdi-minus-box icon-xmd"></span>
				</button>
			</div>
		</nav>

		<!-- partial -->
		<div class="container-fluid page-body-wrapper">

			<nav class="sidebar sidebar-offcanvas fixed_menu" id="sidebar">
				<ul class="nav">
					<li class="nav-item nav-profile">
						<div class="nav-link">
							<!-- <div class="user-wrapper">
								<div class="profile-image">
									<img th:src="@{'/resources'+${userProfile.getUserpics()}}" alt="profile image">
								</div>
								<div class="text-wrapper">
									<span class="profile-name" th:text="${user.getFname()}">홍길동</span>
									<span>&nbsp;님</span>
									<div>
										<small class="designation text-muted" style="padding: 0 6px 0 0px;">member</small>
										<span class="status-indicator online"></span>
									</div>
								</div>
							</div> -->
							<!-- <form th:action="@{'/logout'}" method="post">
								<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
								<button class="btn btn-secondary btn-block" type="submit">
									<h5 style="margin-block-end: 0em;">
										<i class="menu-icon mdi mdi-power"></i>
										Log - Out
									</h5>
								</button>
							</form> -->
						</div>
					</li>

					<li class="nav-item" style="text-align: center;"><a class="nav-link" th:href="@{'/user/'}"> <i class="mdi mdi-dots-horizontal icon-md"></i> <span class="menu-title font-b"> &nbsp<small class="">나의 페이지 </small>
						</span>
					</a></li>
					<li class="nav-item"><a class="nav-link" th:href="@{'/user/intro/'}"> <i class="mdi mdi-dots-vertical icon-md"></i> <span class="menu-title font-b"> &nbsp<small class="">진행과정</small>
						</span>
					</a></li>
					<!-- <li class="nav-item"><a class="nav-link" th:href="@{'/forum/write'}"> <i class="mdi mdi-menu-left icon-md"></i> <span class="menu-title font-b"> &nbsp<small class="">글쓰기</small>
						</span>  
					</a></li> -->
					<li class="nav-item"><a class="nav-link" th:href="@{'/forum/viewpostslist'}"> <i class="mdi mdi-menu-up icon-md"></i> <span class="menu-title font-b"> &nbsp<small class="">글보기</small>
						</span>
					</a></li>
					<li class="nav-item"><a class="nav-link" th:href="@{'/school/all'}"> <i class="mdi mdi-drag-vertical icon-md"></i> <span class="menu-title font-b"> &nbsp<small class="">어학원 가격정보</small>
						</span>
					</a></li>
					<li class="nav-item bg-color-a">
						<form id="logout" th:action="@{'/logout'}" method="post">
							<a href="#" class="nav-link" onclick="document.getElementById('logout').submit()"> <i class="mdi mdi-power icon-md"></i> <span class="menu-title font-b"> &nbsp<small class="">로그아웃</small>
							</span>
							</a>
						</form>
					</li>
				</ul>
			</nav>

			<!-- partial -->
			<div class="main-panel margin_for_fixed">
				<div class="content-wrapper">

					<div class="col-lg-8 mx-auto">

						<div th:if="${post == null}">
							<p>게시물이 없습니다</p>
						</div>

						<div th:if="${post != null}" class="col-lg-11 mx-auto">
							<table class="table mui-table mui-table--bordered borderon" style="max-width: 100%;">
								<thead>
									<tr class="borderon">
										<th colspan=2>
											<div>
												<span th:text="${post.title}"> 제목 </span>
											</div>
										</th>
									</tr>
									<tr class="borderon">
										<!-- <th><div style="height: 100%; width: 100%;"><span th:text="${post.user.fname}"> 글쓴이 </span></div></th> -->
										<th>
											<div>
												<span th:attr="style=${#strings.contains(post.user.email,'admin@java.com')}? 'color:DeepPink;' : ''" th:text="${#strings.contains(post.user.email, 'admin@java.com')}? '리피' : ${post.user.getMaskedEmail()}"> 작성자 </span> <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}" th:text=${post.user.email}></span>
											</div>

										</th>
										<th>
											<div class="text-right">
												<span th:text="${#dates.format(post.datecreated, 'dd MMM yyyy')}"> 작성날짜 </span>
											</div>
										</th>
									</tr>
								</thead>
								<tbody>
									<tr class="borderon">
										<td colspan=2>
											<div style="height: 100%; width: 100%;">
												<span> <!-- <p th:utext="${#strings.replace( #strings.escapeXml( post.content ),T(java.lang.System).getProperty('line.separator'),'&lt;br /&gt;')}">글내용</p> -->
													<p th:utext="${#strings.replace( post.content ,T(java.lang.System).getProperty('line.separator'),'&lt;br /&gt;')}">글내용</p>
												</span>
											</div>

											<div style="text-align: right;">
												<small> <span> <a href="comments.html" th:href="@{'/forum/update/'+${post.idpost}+'?u='+${post.user.id}}" th:if="${user.id} eq ${post.user.id} or ${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">수정</a>
												</span> <span>
														<div th:if="${user.id} eq ${post.user.id} or ${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
															<form id="delete_form" th:action="@{'/forum/delete/'+${post.idpost}+'?u='+${user.id}}" method="post" />
															<a href="javascript:{}" onclick="document.getElementById('delete_form').submit(); return false;">삭제</a>
															</form>
														</div>
												</span>
												</small>
											</div>


										</td>
									</tr>
								</tbody>
							</table>

							<!-- content-wrapper ends -->
							<div class="w-100 grid-margin flex-wrap borderon d-none " id="instafeed" style="padding: 10px 0 10px 0; margin: 0;">
								<div class="col-lg-12 borderon" style="padding: 0px">
									<div class="card borderon">
										<div class="card-body borderon" style="padding: 0;">
											<img th:src="@{'/resources/images/blank.png'}" width="100%" height="100%" id="slot01" />
										</div>
									</div>
								</div>
							</div>

							<div th:if="${errormsg}">
								<div class="text-danger card-description">
									<span th:text="${errormsg}"></span>
								</div>
							</div>

							<form id="post_writing" th:action="@{'/forum/writeReply/'+${post.idpost}}" th:object="${reply}" class="mui-form mui-panel-no-shadow" method="POST" />
							<div class="mui-textfield">
								<textarea name="content" th:field="${reply.content}" placeholder="" class="mui-reply"></textarea>
								<!-- <label>덧글달기</label> -->
							</div>
							<button type="submit" class="mui-btn mui-btn--flat font-b">댓글달기</button>
							</form>


							<div th:if="${#lists.isEmpty(replys)}">
								<p>댓글이 없습니다</p>
							</div>

							<div th:if="!${#lists.isEmpty(replys)}">
								<table class="table mui-table mui-table--bordered borderon">
									<!-- <thead>
									<tr>
										<th>제목</th>
										<th>날짜</th>
									</tr>
								</thead> -->
									<tbody>
										<tr th:each="reply : ${replys}">
											<td>
												<div style="height: 100%; width: 100%;">
													<div th:attr="style=${#strings.contains(reply.user.email,'admin@java.com')}? 'color:DeepPink;' : ''">
														<span>
															<p th:utext="${#strings.replace( reply.content ,T(java.lang.System).getProperty('line.separator'),'&lt;br /&gt;')}">댓글내용</p>
														</span>
													</div>

													<!-- 	</div> -->
												</div> <!-- </td>
										<td class="borderon"> -->
												<div style="text-align: right;">
													<small> <span th:text="${#dates.format(reply.datecreated, 'dd MMM yyyy')}"> 댓글날짜 </span> <span th:attr="style=${#strings.contains(reply.user.email,'admin@java.com')}? 'color:DeepPink;' : ''" th:text="${#strings.contains(reply.user.email, 'admin@java.com')}? '리피' : ${reply.user.getMaskedEmail()}"> 댓글작성자 </span>
													</small>
												</div>
												<div style="text-align: right;">
													<small> <!--  if this user is owner of reply ?? how to check? user.email 
															"${item.codItem} eq ${defaultCodItem}"
													
													 --> <span> <!-- <a href="comments.html" th:href="@{'/forum/update/'+${post.idpost}}" th:if="${isThisUserOriginalPosterOrAdmin} == true">수정</a> -->
													</span> <!-- &nbsp --> <span>
															<div th:if="${user.id} eq ${reply.user.id} or ${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
																<form th:id="'id' + ${reply.idreply}" th:action="@{'/forum/deleteReply/'+${reply.idreply}+'?idpost='+${post.idpost}}" method="post" />
																<a href="javascript:{}" th:onclick="'document.getElementById(\'id' + ${reply.idreply} + '\').submit(); return false;'">삭제</a>
																</form>
															</div>
													</span> <!-- <p th:text=${reply.idreply}>댓글 아이디</p> -->
													</small>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>

							<div class="mui-form mui-panel-no-shadow">
								<form th:action="@{'/forum/viewpostslist'}" method="get">
									<input class="mui-btn mui-btn--flat font-b" type="submit" value="글목록" style="width: 100%;" />
								</form>
							</div>

						</div>
					</div>



				</div>
				<!-- content-wrapper ends -->
				<!-- partial:partials/_footer.html -->
				<footer class="footer">
					<div class="container-fluid clearfix">
						<span class="text-muted d-block text-center text-sm-left d-sm-inline-block font-b"> Copyright © 2019 <a href="#" target="_blank">리피의 아일랜드</a> . All rights reserved.
						</span> <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center font-b"> 당신의 성공적인 어학연수를 위해 <i class="mdi mdi-heart text-danger"></i>
						</span>
					</div>
				</footer>
				<!-- partial -->
			</div>
			<!-- main-panel ends -->
		</div>
		<!-- page-body-wrapper ends -->
	</div>



	<div id="openModal" class="modalDialog">
		<div>
			<a href="#close" title="Close" class="close">X</a>

			<h2>리피의 아일랜드 회원탈퇴</h2>

			<p>정말로 회원을 탈퇴하십니까? 당신과 관련된 모든자료는 폐기되고 복구되지 않습니다.</p>
			<form th:action="@{'/user/delete'}" method="post">
				<input class="btn btn-lg btn-primary btn-lg" type="submit" value="탈퇴하기" />
			</form>
		</div>
	</div>
	<!-- container-scroller -->

	<script th:inline="javascript">
    	var insta = /*[[${post.insta}]]*/ null
	</script>

	<script th:inline="text">
	if (insta !== null){
		fetch("[[@{'/api/school/insta/' + ${post.insta} }]]")
        .then((res) => res.json())
        .then(function(data) {
        	console.log(data)
            return data.entry_data.ProfilePage["0"].graphql.user.edge_owner_to_timeline_media.edges;
        }).then(function(data) {
        	console.log(data)
            return data.map(dataItem => dataItem.node.display_url)
        }).then(data => {
        	console.log(data)
            var location = data[0]
            document.getElementById("slot01").setAttribute("src", location)
            document.getElementById("instafeed").classList.remove('d-none');
            document.getElementById("instafeed").classList.add('d-flex');
        })
        .catch(function(e) {
            console.log(e);
        })
	}
	
    function getElementByXpath(path) {
        return document.evaluate(path, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
    }
    </script>

	<!-- plugins:js -->
	<script th:src="@{'/resources/vendors/js/vendor.bundle.base.js'}"></script>
	<script th:src="@{'/resources/vendors/js/vendor.bundle.addons.js'}"></script>
	<!-- endinject -->
	<!-- inject:js -->
	<script th:src="@{'/resources/js/off-canvas.js'}"></script>
	<script th:src="@{'/resources/js/misc.js'}"></script>
	<!-- endinject -->
	<!-- Custom js for this page-->
	<script th:src="@{'/resources/js/dashboard.js'}"></script>
	<!-- End custom js for this page-->
	<script th:src="@{'/resources/js/custom.js'}"></script>
</body>

</html>
